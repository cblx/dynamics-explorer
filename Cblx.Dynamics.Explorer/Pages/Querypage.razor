@page "/"
@using System.Net.Http.Json;
@using System.Text.Json.Nodes;
@using System.Text.Json;
@inject HttpClient HttpClient
<MudStack Class="px-4">
    <MudTextField Label="GET" Lines="10" @bind-Value="_query" />
    <MudStack AlignItems="AlignItems.Start">
        <MudButton Disabled="_searching" Color="Color.Primary" Variant="Variant.Filled" OnClick="RunAsync">Run</MudButton>
    </MudStack>
    @if(_searching)
    {
        <MudProgressCircular Size="Size.Small" Indeterminate />
    }else{
    <MudPaper>
        <Virtualize Items="_json">
            <div style="white-space: pre">
                @context
            </div>
        </Virtualize>
    </MudPaper>
    }
</MudStack>
@code {
    private string _query = "accounts";
    private string[] _json = Array.Empty<string>();
    private bool _searching = false;
    public async Task RunAsync()
    {
        _searching = true;
        try
        {
            var response = await HttpClient.GetAsync(_query);
            var json = await response.Content.ReadFromJsonAsync<JsonObject>();
            var strJson = JsonSerializer.Serialize(json, new JsonSerializerOptions { WriteIndented = true });
            _json = strJson.ToString().Split(Environment.NewLine);
        }
        catch { }
        finally
        {
            _searching = false;
        }
    }
}
